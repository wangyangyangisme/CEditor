<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>编辑</title>
    <link rel="stylesheet" href="css/editormd.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/editor.css">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/editormd.min.js"></script>
</head>
<style>
    .editormd {
        border: none;
        border-radius: 8px;
    }
</style>
<body class="baitian">
<div class="container-fluid">
    <div class="row home">
        <h1><b><a href="#">CEditor</a></b></h1>
        <!--<h3>
            <small><i>让你专注写作</i></small>
        </h3>-->
        <!--<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample"
                aria-expanded="false" aria-controls="collapseExample">
            Button with data-target
        </button>
        <div class="collapse" id="collapseExample">
            <div class="well">
                ...
            </div>
        </div>-->
    </div>
    <div class="setting">
        <span class="glyphicon glyphicon-edit" style="color: #f9f9f9; font-size: 30px; padding: 13px;"></span>
        <div class="writeHelp" id="writeHelp">
            <h4 class="text-center"><span class="glyphicon glyphicon-cog"></span> 设置</h4>
            <div class="form-group" style="margin-bottom: 30px">
                <label>主题</label>
                <div class="btn-group" data-toggle="buttons">
                    <label class="btn btn-default active" onclick="chooseTheme('sun');">
                        <input type="radio" name="options" id="sun" autocomplete="off" checked>白天
                    </label>
                    <label class="btn btn-default" onclick="chooseTheme('moon')">
                        <input type="radio" name="options" id="moon" autocomplete="off">黑夜
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label for="title">文章标题</label>
                <input type="text" class="form-control" id="title">
            </div>
            <div class="form-group">
                <label for="sort">文章分类</label>
                <select class="form-control" id="sort">
                    <option value="">+ 新建分类</option>
                    <option value="JAVA" selected="selected">JAVA</option>
                    <option value="C++">C++</option>
                    <option value="生活">生活</option>
                    <option value="随笔">随笔</option>
                </select>
            </div>
            <div>
                <button type="button" class="btn btn-default" id="caogao" onclick="openCaogao();">草稿管理</button>
            </div>
            <div style="padding-bottom: 20px; margin-top: 20px" class="text-center">
                <a href="javascript:$.proxy(editor.toolbarHandlers.help, editor)();"><span>Markdown使用帮助</span></a>
            </div>
            <div class="btn-group pull-right" role="group">
                <button type="button" class="btn btn-default" id="save" onclick="savelocal();"><span class="glyphicon glyphicon-floppy-saved"></span> 保存</button>
                <button type="button" class="btn btn-default" id="share"><span class="glyphicon glyphicon-share-alt"></span> 发布</button>
            </div>
        </div>
        <div class="writeCaogao" id="writeCaogao">
            <h4 class="text-center"><span class="glyphicon glyphicon-duplicate"></span> 草稿管理</h4>
            <div class="table-responsive" style="height: 380px">
                <table class="table table-hover">
                    <tr><th>标题</th><th>分类</th><th>时间</th><th></th></tr>
                </table>
                <div class="loading">
                    <img src="images/loading.gif" alt="">
                    <span>正在读取数据。。。</span>
                </div>
            </div>
            <div class="pull-right">
                <button type="button" class="btn btn-default" id="Cexit" onclick="Cexit()"><span class="glyphicon glyphicon-arrow-right"></span> 返回</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2 col-xs-12 editor">
            <div id="editormd">
                <textarea style="display:none;">### Hello !</textarea>
            </div>
        </div>
    </div>
</div>
</body>

<script>
    var editor;
    $(function () {
        //读取本地草稿
            getlocal();
        // 配置编译器
            editor = editormd({
            id: "editormd",
            path: "editor/lib/",
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL: "main.upload",
            //editor.md期望得到一个json格式的上传后的返回值，格式是这样的：
            /*
            {
                success : 0 | 1,           // 0 表示上传失败，1 表示上传成功
                message : "提示的信息，上传成功或上传失败及错误信息等。",
                url     : "图片地址"        // 上传成功时才返回
            }
                      saveHTMLToTextarea : true,
                      emoji : true,
                      taskList: true,
                      /*tocm: true,
                      tex: true,
                      flowChart: true,
                      sequenceDiagram: true,*/
            toolbarIcons: function () {
                // Or return editormd.toolbarModes[name]; // full, simple, mini
                // Using "||" set icons align right.
                return ["undo", "redo", "|", "bold", "del", "italic", "quote", "ucwords", "uppercase", "lowercase", "|", "h1", "h2", "h3", "h4", "h5", "h6", "|", "list-ul", "list-ol", "hr", "|", "link", "reference-link", "image", "code", "preformatted-text", "code-block", "table", "datetime", "emoji", "html-entities", "pagebreak", "|", "goto-line", "clear", "search", "||", "watch", "preview", "fullscreen"]
            },
        });
        
    });
    
    //改变主题
    function chooseTheme(o) {
        if (o == 'moon') {
            editor.setTheme('dark');
            editor.setCodeMirrorTheme('lesser-dark');
            editor.setPreviewTheme('dark');
            $('body').attr('class', 'heiye');
        }
        else {
            editor.setTheme('default');
            editor.setCodeMirrorTheme('default');
            editor.setPreviewTheme('default');
            $('body').attr('class', 'baitian');
        }
    }
    
    //保存到本地
    function savelocal() {
        var source = editor.getMarkdown();
        var title = $('#title').val();
        var sort = $('#sort').val();
        var articleDate = {title:title,sort:sort,source:source};
        window.localStorage.setItem('articleDate', JSON.stringify(articleDate));
        if (localStorage.getItem('articleDate') == null) {
            alert('保存失败请重试');
        } else {
            alert("保存成功！");
        }
    }
    
    //从本地读取
    function getlocal() {
        if (localStorage.getItem('articleDate') != null) {
            var temp, source, title, sort;
            temp = localStorage.getItem('articleDate');
            var articleDate = JSON.parse(temp);
            source = articleDate.source;
            title = articleDate.title;
            sort = articleDate.sort;
//            $('#title').val(title);
//            $('#sort').val(sort);
//            $('textarea').val(source);
        }
    }

    //打开草稿管理
    function openCaogao() {
        $('#writeHelp').css("display", "none");
//        $('#writeCaogao').css("display", "block");
        $('#writeCaogao').slideDown(300);
    }
    function Cexit() {
        $('#writeCaogao').css('display', 'none');
        $('#writeHelp').css('display', 'block');
    }
</script>
</html>